-- MAME.VW_QC_ANALISI_RM source

CREATE OR REPLACE VIEW mame.VW_QC_ANALISI_RM AS
SELECT
    COALESCE(YNORME_QLT.ALIAS_ACCIAIO, '') AS ALLIAS_ACCIAIO,
    YNORME_QLT.DSC_ACCIAIO AS ACCIAIO,
    YNORME_QLT.FUSIONE_ACCIAIO - 1 AS TP_FUS_ACC,
    DIPEND_APRV.COGNOME || ' ' || DIPEND_APRV.NOME AS DOC_REV_APPR,
    DIPEND_CRZ.COGNOME || ' ' || DIPEND_CRZ.NOME AS DOC_REV_PREP,
    YNORME_QLT.ID_NORMA AS ID,
    YNORME_QLT.NOTE1 AS NOTE,
    YNORME_QLT.NOTE2 AS NOTE_2,
    YNORME_QLT.NOTE3 AS NOTE_3,
    CASE
        WHEN YNORME_QLT.PROCESSO_SPEC = 'Y' THEN 1
        ELSE 0
    END AS FLAG_PR_SPE,
    YNORME_QLT.REVISIONE AS DOC_REV,
    YNORME_QLT.RM_NUM,
    YNORME_QLT.SPEC_RIF_COD1 AS STD_ACC,
    YNORME_QLT.SPEC_RIF_COD2 AS STD_ACC_2,
    YNORME_QLT.SPEC_RIF_COD3 AS STD_ACC_3,
    YNORME_QLT.SPEC_RIF_COD4 AS STD_ACC_4,
    YNORME_QLT.SPEC_RIF_COD5 AS STD_ACC_5,
    YNORME_QLT.SPEC_RIF_COD6 AS STD_ACC_6,
    YNORME_QLT.SPEC_RIF_DSC1 AS STD_ACC_DES,
    YNORME_QLT.SPEC_RIF_DSC2 AS STD_ACC_DES_2,
    YNORME_QLT.SPEC_RIF_DSC3 AS STD_ACC_DES_3,
    YNORME_QLT.SPEC_RIF_DSC4 AS STD_ACC_DES_4,
    YNORME_QLT.SPEC_RIF_DSC5 AS STD_ACC_DES_5,
    YNORME_QLT.SPEC_RIF_DSC6 AS STD_ACC_DES_6,
    YNORME_QLT.TAS_INCL_A,
    YNORME_QLT.TAS_INCL_B,
    YNORME_QLT.TAS_INCL_C,
    YNORME_QLT.TAS_INCL_D,
    YNORME_QLT.TAS_INCL_GA AS TAS_INCL_A_G,
    YNORME_QLT.TAS_INCL_GB AS TAS_INCL_B_G,
    YNORME_QLT.TAS_INCL_GC AS TAS_INCL_C_G,
    YNORME_QLT.TAS_INCL_GD AS TAS_INCL_D_G,
    YNORME_QLT.TAS_INCL_NOTE1 AS TAS_INCL_NOTE_1,
    YNORME_QLT.TAS_INCL_NOTE2 AS TAS_INCL_NOTE_2,
    YNORME_QLT.TAS_INCL_NOTE3 AS TAS_INCL_NOTE_3,
    YNORME_QLT.DOC_RICH - 1 AS DOC_RICH,
    CASE
        WHEN YNORME_QLT.TYP_AFF_ACC01 = 'Y' THEN 1
        ELSE 0
    END AS TP_AFF_ACC,
    CASE
        WHEN YNORME_QLT.TYP_AFF_ACC02 = 'Y' THEN 1
        ELSE 0
    END AS TP_AFF_ACC_2,
    CASE
        WHEN YNORME_QLT.TYP_AFF_ACC03 = 'Y' THEN 1
        ELSE 0
    END AS TP_AFF_ACC_3,
    CASE
        WHEN YNORME_QLT.TYP_AFF_ACC04 = 'Y' THEN 1
        ELSE 0
    END AS TP_AFF_ACC_4,
    CASE
        WHEN YNORME_QLT.TYP_AFF_ACC05 = 'Y' THEN 1
        ELSE 0
    END AS TP_AFF_ACC_5,
    CASE
        WHEN YNORME_QLT.TYP_AFF_ACC06 = 'Y' THEN 1
        ELSE 0
    END AS TP_AFF_ACC_6,
    CASE
        WHEN YNORME_QLT.TYP_AFF_GRA01 = 'Y' THEN 1
        ELSE 0
    END AS TP_AFF_GR_1,
    YNORME_QLT.DESCRIZIONE AS RM_NUM_REV,
    YNORME_QLT.RM_OR_NUM AS RM_OR_N,
    YNORME_QLT.DSC_VAL_PROD AS DES_VALORE_PRODOTTO,
    YNORME_QLT.DESCRIZIONE2 AS DOC_DESC_REV,
    YNORME_QLT.TIMESTAMP_CRZ AS DOC_DATA_REV,
    YNORME_QLT.TAS_INCL_DSC AS TAS_INCL_ACT,
    YNORME_QLT.TAS_INCLG_DSC AS TAS_INCL_ACT_G,
    '' AS TP_AFF_GR,
    CASE
        WHEN TIPOLOGIA = 2 THEN 1
        ELSE 0
    END AS FLAG_RMC,
    YNORME_QLT.TIMESTAMP_AGG,
    S_AL.INF AS AL_FLAG_INF,
    S_ALSOL.INF AS ALSOL_FLAG_INF,
    S_AL.LIM_INF_TOL AS AL_MIN,
    S_AL.LIM_SUP_TOL AS AL_MAX,
    S_ALSOL.INF AS ALSOL_INF,
    S_ALSOL.LIM_INF_TOL AS ALSOL_MIN,
    S_ALSOL.LIM_SUP_TOL AS ALSOL_MAX,
    S_AS.INF AS AS_FLAG_INF,
    S_AS.LIM_INF_TOL AS AS_MIN,
    S_AS.LIM_SUP_TOL AS AS_MAX,
    S_B.INF AS B_FLAG_INF,
    S_B.LIM_INF_TOL AS B_MIN,
    S_B.LIM_SUP_TOL AS B_MAX,
    S_BI.INF AS BI_FLAG_INF,
    S_BI.LIM_INF_TOL AS BI_MIN,
    S_BI.LIM_SUP_TOL AS BI_MAX,
    S_C.INF AS C_FLAG_INF,
    S_C.LIM_INF_TOL AS C_MIN,
    S_C.LIM_SUP_TOL AS C_MAX,
    S_C_N.INF AS C_N_FLAG_INF,
    S_C_N.LIM_INF_TOL AS C_N_MIN,
    S_C_N.LIM_SUP_TOL AS C_N_MAX,
    S_CA.INF AS CA_FLAG_INF,
    S_CA.LIM_INF_TOL AS CA_MIN,
    S_CA.LIM_SUP_TOL AS CA_MAX,
    S_CB.INF AS CB_FLAG_INF,
    S_CB.LIM_INF_TOL AS CB_MIN,
    S_CB.LIM_SUP_TOL AS CB_MAX,
    S_CE.INF AS CE_FLAG_INF,
    S_CE.LIM_INF_TOL AS CE_MIN,
    S_CE.LIM_SUP_TOL AS CE_MAX,
    S_CO.INF AS CO_FLAG_INF,
    S_CO.LIM_INF_TOL AS CO_MIN,
    S_CO.LIM_SUP_TOL AS CO_MAX,
    S_CR.INF AS CR_FLAG_INF,
    S_CR.LIM_INF_TOL AS CR_MIN,
    S_CR.LIM_SUP_TOL AS CR_MAX,
    S_CR_EQ.INF AS CR_EQ_FLAG_INF,
    S_CR_EQ.LIM_INF_TOL AS CR_EQ_MIN,
    S_CR_EQ.LIM_SUP_TOL AS CR_EQ_MAX,
    S_CU.INF AS CU_FLAG_INF,
    S_CU.LIM_INF_TOL AS CU_MIN,
    S_CU.LIM_SUP_TOL AS CU_MAX,
    S_FE.INF AS FE_FLAG_INF,
    S_FE.LIM_INF_TOL AS FE_MIN,
    S_FE.LIM_SUP_TOL AS FE_MAX,
    S_H.INF AS H_FLAG_INF,
    S_H.LIM_INF_TOL AS H_MIN,
    S_H.LIM_SUP_TOL AS H_MAX,
    CASE
        WHEN S_H.R_UNITA_MISURA IN ('%',
                       'P%') THEN 1
        ELSE 0
    END AS H_PPM_O_PERC,
    S_JF.INF AS JF_FLAG_INF,
    S_JF.LIM_INF_TOL AS JF_MIN,
    S_JF.LIM_SUP_TOL AS JF_MAX,
    S_MN.INF AS MN_FLAG_INF,
    S_MN.LIM_INF_TOL AS MN_MIN,
    S_MN.LIM_SUP_TOL AS MN_MAX,
    S_MO.INF AS MO_FLAG_INF,
    S_MO.LIM_INF_TOL AS MO_MIN,
    S_MO.LIM_SUP_TOL AS MO_MAX,
    S_N.INF AS N_FLAG_INF,
    S_N.LIM_INF_TOL AS N_MIN,
    S_N.LIM_SUP_TOL AS N_MAX,
    CASE
        WHEN S_N.R_UNITA_MISURA IN ('%', 'P%') THEN 1
        ELSE 0
    END AS N_PPM_O_PERC,
    S_NB.INF AS NB_FLAG_INF,
    S_NB.LIM_INF_TOL AS NB_MIN,
    S_NB.LIM_SUP_TOL AS NB_MAX,
    S_NB_TA.INF AS NB_TA_FLAG_INF,
    S_NB_TA.LIM_INF_TOL AS NB_TA_MIN,
    S_NB_TA.LIM_SUP_TOL AS NB_TA_MAX,
    S_NI.INF AS NI_FLAG_INF,
    S_NI.LIM_INF_TOL AS NI_MIN,
    S_NI.LIM_SUP_TOL AS NI_MAX,
    S_O.INF AS O_FLAG_INF,
    S_O.LIM_INF_TOL AS O_MIN,
    S_O.LIM_SUP_TOL AS O_MAX,
    CASE
        WHEN S_O.R_UNITA_MISURA IN ('%', 'P%') THEN 1
        ELSE 0
    END AS O_PPM_O_PERC,
    S_P.INF AS P_FLAG_INF,
    S_P.LIM_INF_TOL AS P_MIN,
    S_P.LIM_SUP_TOL AS P_MAX,
    S_PB.INF AS PB_FLAG_INF,
    S_PB.LIM_INF_TOL AS PB_MIN,
    S_PB.LIM_SUP_TOL AS PB_MAX,
    S_PCM.INF AS PCM_FLAG_INF,
    S_PCM.LIM_INF_TOL AS PCM_MIN,
    S_PCM.LIM_SUP_TOL AS PCM_MAX,
    S_PRE.INF AS PRE_FLAG_INF,
    S_PRE.LIM_INF_TOL AS PRE_MIN,
    S_PRE.LIM_SUP_TOL AS PRE_MAX,
    S_S.INF AS S_FLAG_INF,
    S_S.LIM_INF_TOL AS S_MIN,
    S_S.LIM_SUP_TOL AS S_MAX,
    S_SB.INF AS SB_FLAG_INF,
    S_SB.LIM_INF_TOL AS SB_MIN,
    S_SB.LIM_SUP_TOL AS SB_MAX,
    S_SI.INF AS SI_FLAG_INF,
    S_SI.LIM_INF_TOL AS SI_MIN,
    S_SI.LIM_SUP_TOL AS SI_MAX,
    S_SN.INF AS SN_FLAG_INF,
    S_SN.LIM_INF_TOL AS SN_MIN,
    S_SN.LIM_SUP_TOL AS SN_MAX,
    S_TA.INF AS TA_FLAG_INF,
    S_TA.LIM_INF_TOL AS TA_MIN,
    S_TA.LIM_SUP_TOL AS TA_MAX,
    S_TI.INF AS TI_FLAG_INF,
    S_TI.LIM_INF_TOL AS TI_MIN,
    S_TI.LIM_SUP_TOL AS TI_MAX,
    S_V.INF AS V_FLAG_INF,
    S_V.LIM_INF_TOL AS V_MIN,
    S_V.LIM_SUP_TOL AS V_MAX,
    S_W.INF AS W_FLAG_INF,
    S_W.LIM_INF_TOL AS W_MIN,
    S_W.LIM_SUP_TOL AS W_MAX,
    S_XF.INF AS XF_FLAG_INF,
    S_XF.LIM_INF_TOL AS XF_MIN,
    S_XF.LIM_SUP_TOL AS XF_MAX,
    S_Y.INF AS Y_FLAG_INF,
    S_Y.LIM_INF_TOL AS Y_MIN,
    S_Y.LIM_SUP_TOL AS Y_MAX,
    S_ZR.INF AS ZR_FLAG_INF,
    S_ZR.LIM_INF_TOL AS ZR_MIN,
    S_ZR.LIM_SUP_TOL AS ZR_MAX,
    S_FORM_1.DESCR_RIDOTTA AS AC_FORMULA_1,
    S_FORM_1.LIM_SUP_TOL AS AC_FORMULA_1_MAX,
    S_FORM_1.LIM_INF_TOL AS AC_FORMULA_1_MIN,
    S_FORM_2.DESCR_RIDOTTA AS AC_FORMULA_2,
    S_FORM_2.LIM_SUP_TOL AS AC_FORMULA_2_MAX,
    S_FORM_2.LIM_INF_TOL AS AC_FORMULA_2_MIN,
    S_FORM_3.DESCR_RIDOTTA AS AC_FORMULA_3,
    S_FORM_3.LIM_SUP_TOL AS AC_FORMULA_3_MAX,
    S_FORM_3.LIM_INF_TOL AS AC_FORMULA_3_MIN,
    S_FORM_4.DESCR_RIDOTTA AS AC_FORMULA_4,
    S_FORM_4.LIM_SUP_TOL AS AC_FORMULA_4_MAX,
    S_FORM_4.LIM_INF_TOL AS AC_FORMULA_4_MIN,
    S_FORM_5.DESCR_RIDOTTA AS AC_FORMULA_5,
    S_FORM_5.LIM_SUP_TOL AS AC_FORMULA_5_MAX,
    S_FORM_5.LIM_INF_TOL AS AC_FORMULA_5_MIN
FROM
    THIP.SGQ_CICLI_TES AS SGQ_CICLI_TES
INNER JOIN
                      THIP.SGQ_CICLI_FAS AS SGQ_CICLI_FAS ON
    SGQ_CICLI_FAS.ID_AZIENDA = SGQ_CICLI_TES.ID_AZIENDA
    AND 
                      SGQ_CICLI_FAS.ID_PROGRESSIVO = SGQ_CICLI_TES.ID_PROGRESSIVO
INNER JOIN
                      MAME.YNORME_QLT AS YNORME_QLT ON
    SGQ_CICLI_TES.ID_AZIENDA = YNORME_QLT.ID_AZIENDA
    AND 
                      SGQ_CICLI_TES.ID_PROGRESSIVO = YNORME_QLT.ID_AN_CHIM
LEFT OUTER JOIN
                      THIP.DIPENDENTI AS DIPEND_APRV ON
    YNORME_QLT.ID_AZIENDA = DIPEND_APRV.ID_AZIENDA
    AND YNORME_QLT.ID_DIPEND_APRV = DIPEND_APRV.ID_DIPENDENTE
LEFT OUTER JOIN
                      THIP.DIPENDENTI AS DIPEND_CRZ ON
    YNORME_QLT.ID_AZIENDA = DIPEND_CRZ.ID_AZIENDA
    AND YNORME_QLT.ID_DIPEND_CRZ = DIPEND_CRZ.ID_DIPENDENTE
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_AL ON
    S_AL.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_AL.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_AL.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_AL.DESCR_RIDOTTA = 'Al'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_ALSOL ON
    S_ALSOL.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_ALSOL.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_ALSOL.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_ALSOL.DESCR_RIDOTTA = 'Al Sol'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_AS ON
    S_AS.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_AS.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_AS.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_AS.DESCR_RIDOTTA = 'As'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_B ON
    S_B.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_B.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_B.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_B.DESCR_RIDOTTA = 'B'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_BI ON
    S_BI.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_BI.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_BI.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_BI.DESCR_RIDOTTA = 'Bi'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_C ON
    S_C.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_C.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_C.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_C.DESCR_RIDOTTA = 'C'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_CA ON
    S_CA.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_CA.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_CA.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_CA.DESCR_RIDOTTA = 'Ca'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_CB ON
    S_CB.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_CB.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_CB.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_CB.DESCR_RIDOTTA = 'Cb'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_CE ON
    S_CE.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_CE.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_CE.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_CE.DESCR_RIDOTTA = 'Ceq'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_CO ON
    S_CO.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_CO.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_CO.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_CO.DESCR_RIDOTTA = 'Co'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_CR ON
    S_CR.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_CR.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_CR.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_CR.DESCR_RIDOTTA = 'Cr'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_CR_EQ ON
    S_CR_EQ.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_CR_EQ.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_CR_EQ.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_CR_EQ.DESCR_RIDOTTA = 'Creq'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_CU ON
    S_CU.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_CU.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_CU.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_CU.DESCR_RIDOTTA = 'Cu'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_H ON
    S_H.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_H.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_H.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_H.DESCR_RIDOTTA = 'H'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_JF ON
    S_JF.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_JF.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_JF.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_JF.DESCR_RIDOTTA = 'J Fact'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_MN ON
    S_MN.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_MN.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_MN.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_MN.DESCR_RIDOTTA = 'Mn'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_MO ON
    S_MO.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_MO.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_MO.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_MO.DESCR_RIDOTTA = 'Mo'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_N ON
    S_N.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_N.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_N.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_N.DESCR_RIDOTTA = 'N'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_NB ON
    S_NB.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_NB.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_NB.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_NB.DESCR_RIDOTTA = 'Nb'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_NI ON
    S_NI.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_NI.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_NI.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_NI.DESCR_RIDOTTA = 'Ni'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_O ON
    S_O.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_O.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_O.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_O.DESCR_RIDOTTA = 'O'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_P ON
    S_P.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_P.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_P.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_P.DESCR_RIDOTTA = 'P'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_PB ON
    S_PB.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_PB.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_PB.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_PB.DESCR_RIDOTTA = 'Pb'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_PCM ON
    S_PCM.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_PCM.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_PCM.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_PCM.DESCR_RIDOTTA = 'PCM'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_PRE ON
    S_PRE.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_PRE.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_PRE.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_PRE.DESCR_RIDOTTA = 'Pre'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_S ON
    S_S.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_S.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_S.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_S.DESCR_RIDOTTA = 'S'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_SB ON
    S_SB.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_SB.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_SB.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_SB.DESCR_RIDOTTA = 'Sb'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_SI ON
    S_SI.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_SI.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_SI.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_SI.DESCR_RIDOTTA = 'Si'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_SN ON
    S_SN.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_SN.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_SN.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_SN.DESCR_RIDOTTA = 'Sn'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_TA ON
    S_TA.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_TA.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_TA.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_TA.DESCR_RIDOTTA = 'Ta'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_TI ON
    S_TI.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_TI.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_TI.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_TI.DESCR_RIDOTTA = 'Ti'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_V ON
    S_V.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_V.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_V.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_V.DESCR_RIDOTTA = 'V'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_W ON
    S_W.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_W.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_W.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_W.DESCR_RIDOTTA = 'W'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_XF ON
    S_XF.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_XF.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_XF.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_XF.DESCR_RIDOTTA = 'X Fact'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_ZR ON
    S_ZR.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_ZR.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_ZR.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_ZR.DESCR_RIDOTTA = 'Zr'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_C_N ON
    S_C_N.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_C_N.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_C_N.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_C_N.DESCR_RIDOTTA = 'C + N'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_FE ON
    S_FE.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_FE.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_FE.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_FE.DESCR_RIDOTTA = 'Fe'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_NB_TA ON
    S_NB_TA.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_NB_TA.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_NB_TA.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_NB_TA.DESCR_RIDOTTA = 'Nb + Ta'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP AS S_Y ON
    S_Y.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_Y.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_Y.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_Y.DESCR_RIDOTTA = 'Y'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP_FORM AS S_FORM_1 ON
    S_FORM_1.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_FORM_1.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_FORM_1.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_FORM_1.ENUM = '1'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP_FORM AS S_FORM_2 ON
    S_FORM_2.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_FORM_2.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_FORM_2.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_FORM_2.ENUM = '2'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP_FORM AS S_FORM_3 ON
    S_FORM_3.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_FORM_3.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_FORM_3.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_FORM_3.ENUM = '3'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP_FORM AS S_FORM_4 ON
    S_FORM_4.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_FORM_4.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_FORM_4.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_FORM_4.ENUM = '4'
LEFT OUTER JOIN
                      MAME.VW_SGQ_CICLI_CAR_TMP_FORM AS S_FORM_5 ON
    S_FORM_5.ID_AZIENDA = SGQ_CICLI_FAS.ID_AZIENDA
    AND S_FORM_5.ID_PROGRESSIVO = SGQ_CICLI_FAS.ID_PROGRESSIVO
    AND 
                      S_FORM_5.ID_SEQUENZA_FASE = SGQ_CICLI_FAS.ID_SEQUENZA_FASE
    AND S_FORM_5.ENUM = '5';